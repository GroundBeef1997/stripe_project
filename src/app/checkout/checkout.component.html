<div class="store-container">
  <!-- Header -->
  <header class="store-header">
    <div class="logo">
      <svg viewBox="0 0 60 25" xmlns="http://www.w3.org/2000/svg" width="60" height="25">
        <path fill="currentColor" d="M59.64 14.28h-8.06c.19 1.93 1.6 2.55 3.2 2.55 1.64 0 2.96-.37 4.05-.95v3.32a8.33 8.33 0 0 1-4.56 1.1c-4.01 0-6.83-2.5-6.83-7.48 0-4.19 2.39-7.52 6.3-7.52 3.92 0 5.96 3.28 5.96 7.5 0 .4-.04 1.26-.06 1.48zm-5.92-5.62c-1.03 0-2.17.73-2.17 2.58h4.25c0-1.85-1.07-2.58-2.08-2.58zM40.95 20.3c-1.44 0-2.32-.6-2.9-1.04l-.02 4.63-4.12.87V5.57h3.76l.08 1.02a4.7 4.7 0 0 1 3.23-1.29c2.9 0 5.62 2.6 5.62 7.4 0 5.23-2.7 7.6-5.65 7.6zM40 8.95c-.95 0-1.54.34-1.97.81l.02 6.12c.4.44.98.78 1.95.78 1.52 0 2.54-1.65 2.54-3.87 0-2.15-1.04-3.84-2.54-3.84zM28.24 5.57h4.13v14.44h-4.13V5.57zm0-5.09L32.37 0v3.36l-4.13.88V.48zm-4.32 9.35v9.79H19.8V5.57h3.7l.12 1.22c1-1.77 3.07-1.41 3.62-1.22v3.79c-.52-.17-2.29-.43-3.32.47zm-8.55 4.72c0 2.43 2.6 1.68 3.12 1.46v3.36c-.55.3-1.54.54-2.89.54a4.15 4.15 0 0 1-4.27-4.24l.01-13.17 4.02-.86v3.54h3.14V9.1h-3.13v5.45zm-4.91.7c0 3.05-2.84 5.22-7.09 5.22-1.93 0-3.99-.39-5.62-1.23l.96-3.29c1.69.94 3.19 1.1 4.69 1.1 1.14 0 2.03-.37 2.03-1.19 0-1.98-7.23-.85-7.23-5.63 0-2.94 2.5-5.02 6.36-5.02 1.55 0 3.11.23 4.57.8l-.91 3.24c-1.58-.57-2.53-.67-3.72-.67-1.14 0-1.76.43-1.76 1.06 0 1.79 7.22.8 7.22 5.61h.5z"/>
      </svg>
      <span>Test Store</span>
    </div>
    <div class="test-mode-badge">
      <span class="pulse"></span>
      Test Mode
    </div>
  </header>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loadingProducts">
    <div class="spinner"></div>
    <p>Loading products from Stripe...</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="!loadingProducts && errorMessage && products.length === 0">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h2>Connection Error</h2>
    <p>{{ errorMessage }}</p>
    <button class="retry-btn" (click)="fetchAllProducts()">Try Again</button>
  </div>

  <!-- Empty State -->
  <div class="empty-container" *ngIf="!loadingProducts && !errorMessage && products.length === 0">
    <div class="empty-icon">üì¶</div>
    <h2>No Products Found</h2>
    <p>Create some products in your <a href="https://dashboard.stripe.com/test/products" target="_blank">Stripe Dashboard</a> to see them here.</p>
  </div>

  <!-- Products Grid -->
  <div class="products-section" *ngIf="!loadingProducts && products.length > 0">
    <h1 class="section-title">Products</h1>
    <p class="section-subtitle">Select a product to test the checkout flow</p>
    
    <div class="products-grid">
      <div class="product-card" *ngFor="let product of products" (click)="openCheckout(product)">
        <div class="product-image">
          <img *ngIf="product.images && product.images.length > 0" [src]="product.images[0]" [alt]="product.name" />
          <div *ngIf="!product.images || product.images.length === 0" class="placeholder-image">
            <span>{{ product.name.charAt(0) }}</span>
          </div>
        </div>
        <div class="product-details">
          <h3 class="product-name">{{ product.name }}</h3>
          <p class="product-description" *ngIf="product.description">{{ product.description }}</p>
          <div class="product-price" *ngIf="product.default_price">
            {{ formatPrice(product.default_price.unit_amount, product.default_price.currency) }}
          </div>
          <div class="product-price no-price" *ngIf="!product.default_price">
            No price set
          </div>
        </div>
        <button class="buy-btn" [disabled]="!product.default_price">
          <span *ngIf="product.default_price">Buy Now</span>
          <span *ngIf="!product.default_price">Unavailable</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Test Cards Info -->
  <div class="test-cards-info" *ngIf="!loadingProducts && products.length > 0">
    <h3>üß™ Test Card Numbers</h3>
    <div class="cards-grid">
      <div class="test-card">
        <code>4242 4242 4242 4242</code>
        <span>Success</span>
      </div>
      <div class="test-card">
        <code>4000 0000 0000 9995</code>
        <span>Declined</span>
      </div>
      <div class="test-card">
        <code>4000 0025 0000 3155</code>
        <span>Requires Auth</span>
      </div>
    </div>
    <p class="test-card-note">Use any future expiry date and any 3-digit CVC</p>
  </div>
</div>

<!-- Checkout Modal -->
<div class="modal-overlay" *ngIf="showCheckoutModal" (click)="closeCheckout()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeCheckout()">√ó</button>
    
    <div class="modal-product" *ngIf="selectedProduct">
      <div class="modal-product-image">
        <img *ngIf="selectedProduct.images && selectedProduct.images.length > 0" 
             [src]="selectedProduct.images[0]" [alt]="selectedProduct.name" />
        <div *ngIf="!selectedProduct.images || selectedProduct.images.length === 0" class="placeholder-image">
          <span>{{ selectedProduct.name.charAt(0) }}</span>
        </div>
      </div>
      <div class="modal-product-info">
        <h2>{{ selectedProduct.name }}</h2>
        <p *ngIf="selectedProduct.description">{{ selectedProduct.description }}</p>
        <div class="modal-price" *ngIf="selectedProduct.default_price">
          {{ formatPrice(selectedProduct.default_price.unit_amount, selectedProduct.default_price.currency) }}
        </div>
      </div>
    </div>

    <form class="payment-form" (ngSubmit)="handleSubmit($event)">
      <div class="form-group">
        <label>Card Details</label>
        <div class="card-input" #cardElement></div>
      </div>

      <div class="error-message" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>

      <div class="success-message" *ngIf="successMessage">
        ‚úì {{ successMessage }}
      </div>

      <button type="submit" class="pay-btn" [disabled]="loading || !selectedProduct?.default_price">
        <span *ngIf="!loading && selectedProduct?.default_price">
          Pay {{ formatPrice(selectedProduct!.default_price!.unit_amount, selectedProduct!.default_price!.currency) }}
        </span>
        <span *ngIf="loading" class="loading-text">
          <span class="btn-spinner"></span>
          Processing...
        </span>
      </button>

      <p class="secure-note">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
        </svg>
        Secured by Stripe
      </p>
    </form>
  </div>
</div>
